{
  "schema_version": 1,
  "packet_id": "FNP-P2C-004",
  "subtask_id": "FNP-P2C-004-H",
  "generated_at_unix_ms": 1771322468329,
  "environment_fingerprint": "os=linux arch=x86_64 cpus=128 rustc=rustc 1.95.0-nightly (a423f68a0 2026-02-13)",
  "reproducibility_command": "cargo run -p fnp-conformance --bin generate_packet004_optimization_report",
  "lever": {
    "id": "P2C004-H-LEVER-001",
    "description": "Switch flatiter bool-mask lane counting to a branchless, unrolled accumulator",
    "rationale": "Bool-mask validation is a packet hotspot; replacing iterator/filter counting with a branchless unrolled path lowers per-lane overhead while preserving contract behavior.",
    "risk_note": "Risk is low because only counting mechanics changed; bounds checks and all error-class branches remain unchanged.",
    "rollback_command": "git restore --source <last-green-commit> -- crates/fnp-iter/src/lib.rs"
  },
  "baseline_profile": {
    "implementation": "baseline_filter_count_path",
    "runs": 80,
    "elements_per_run": 1048576,
    "percentiles": {
      "p50_ms": 8.261555,
      "p95_ms": 8.678827,
      "p99_ms": 9.684189,
      "min_ms": 8.194279,
      "max_ms": 9.934547
    },
    "throughput_elements_per_sec_p50": 126922352.99528962,
    "throughput_elements_per_sec_p95": 120820014.04106799
  },
  "rebaseline_profile": {
    "implementation": "rebaseline_branchless_unrolled_path",
    "runs": 80,
    "elements_per_run": 1048576,
    "percentiles": {
      "p50_ms": 3.662677,
      "p95_ms": 4.0815,
      "p99_ms": 4.352488,
      "min_ms": 3.61666,
      "max_ms": 4.499142
    },
    "throughput_elements_per_sec_p50": 286286778.7686438,
    "throughput_elements_per_sec_p95": 256909469.55776063
  },
  "delta": {
    "p50_delta_percent": -55.66600960715022,
    "p95_delta_percent": -52.97175528444109,
    "p99_delta_percent": -55.05573053148798,
    "throughput_gain_percent_p50": 125.5605667657836,
    "throughput_gain_percent_p95": 112.63817224059783
  },
  "ev": {
    "impact": 4.0,
    "confidence": 4.0,
    "reuse": 3.0,
    "effort": 2.0,
    "adoption_friction": 1.0,
    "score": 24.0,
    "promoted": true
  },
  "isomorphism_checks": [
    {
      "case_id": "case_boolmask_all_true",
      "status": "pass",
      "details": "baseline and optimized outputs matched"
    },
    {
      "case_id": "case_boolmask_sparse",
      "status": "pass",
      "details": "baseline and optimized outputs matched"
    },
    {
      "case_id": "case_boolmask_length_mismatch",
      "status": "pass",
      "details": "baseline and optimized outputs matched"
    },
    {
      "case_id": "case_fancy_out_of_bounds",
      "status": "pass",
      "details": "baseline and optimized outputs matched"
    }
  ]
}